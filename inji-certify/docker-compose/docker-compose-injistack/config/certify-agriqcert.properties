# ===========================================
# INJI CERTIFY - AGRIQCERT CONFIGURATION
# Digital Product Passport (DPP) for Agricultural Products
# Based on Postgres Data Provider Plugin
# ===========================================

## Integration Plugin Configuration
# Package to scan for plugin implementations (using Postgres DataProvider plugin)
mosip.certify.integration.scan-base-package=io.mosip.certify.postgresdataprovider.integration
mosip.certify.integration.audit-plugin=LoggerAuditService
mosip.certify.integration.data-provider-plugin=PostgresDataProviderPlugin

## Plugin Mode
mosip.certify.plugin-mode=DataProvider

## DID Configuration
# This should be updated to your hosted DID location (e.g., GitHub Pages, your domain)
# For local testing, using localhost
mosip.certify.data-provider-plugin.did-url=did:web:localhost:8090:v1:certify

## Issuer Configuration  
mosip.certify.data-provider-plugin.issuer-uri=http://localhost:8090/v1/certify
mosip.certify.data-provider-plugin.issuer-public-key-uri=http://localhost:8090/v1/certify/system-info/certificate?applicationId=CERTIFY_VC_SIGN_ED25519&referenceId=ED25519_SIGN

## Postgres DataProvider Plugin Configuration
# Database connection for AgriQCert
# Using public schema for AgriQCert tables, certify schema for Inji tables
mosip.certify.data-provider-plugin.postgres.datasource.url=jdbc:postgresql://postgres:5432/postgres?currentSchema=public
mosip.certify.data-provider-plugin.postgres.datasource.username=postgres
mosip.certify.data-provider-plugin.postgres.datasource.password=postgres
mosip.certify.data-provider-plugin.postgres.datasource.driver-class-name=org.postgresql.Driver

## Scope to Query Mapping
# Maps credential scopes to SQL queries for fetching agricultural batch data
# The 'id' parameter will be passed from the access token (typically batch_number or UIN)
mosip.certify.data-provider-plugin.postgres.scope-query-mapping={\
  'agricultural_quality_certificate_vc_ldp': '\
    SELECT \
      b.batch_number, \
      b.product_type, \
      b.product_name, \
      b.quantity, \
      b.unit, \
      b.origin_location, \
      b.destination_country, \
      b.harvest_date, \
      b.packaging_type, \
      b.storage_conditions, \
      b.hsn_code, \
      u.full_name as exporter_name, \
      u.email as exporter_email, \
      u.organization as exporter_organization, \
      u.license_number as exporter_license, \
      i.inspection_date, \
      i.moisture_level, \
      i.pesticide_details, \
      i.aflatoxin_level, \
      i.foreign_matter, \
      i.grain_quality_score, \
      i.is_organic, \
      i.is_gmo_free, \
      i.meets_iso_22000, \
      i.meets_haccp, \
      i.iso_code, \
      i.compliance_standards, \
      i.lab_name, \
      i.lab_accreditation, \
      i.remarks, \
      qa.full_name as inspector_name, \
      qa.license_number as inspector_license, \
      qa.organization as qa_organization \
    FROM batches b \
    INNER JOIN users u ON b.submitted_by = u.id \
    INNER JOIN inspections i ON b.id = i.batch_id \
    INNER JOIN users qa ON i.inspector_id = qa.id \
    WHERE b.batch_number = :id AND i.result = ''CERTIFIED'' \
  '\
}

## Cache Configuration (inherited from default, can be overridden if needed)
# mosip.certify.cache.names=userinfo,vcissuance,certificatedatacache,credentialConfig,renderTemplate
